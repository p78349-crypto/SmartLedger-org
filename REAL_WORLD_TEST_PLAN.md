# 🧪 현실 사용 가능 여부 검증 - 최종 테스트 계획

## 핵심 플로우 검증

## UI/레이아웃 회귀 체크 (실기기)

### 1페이지(가족 페이지) 하단 4개 아이콘
- ✅ 하단 4개 아이콘 영역이 화면 최하단(SafeArea 포함)에 고정되어 있는가?
- ✅ 키보드(메모/입력) 표시 시에도 하단 영역이 가려지거나 오버플로우 되지 않는가?

### 아이콘 페이지(아이콘 그리드)
- ✅ `빈 슬롯 숨김` 설정 ON + 일반 모드: 빈 슬롯의 `+` 아이콘이 보이지 않는가?
- ✅ `빈 슬롯 숨김` 설정 ON + 편집 모드: 빈 슬롯의 `+` 아이콘이 보이는가?
- ✅ 편집 모드에서 드래그&드롭으로 아이콘 이동/스왑이 정상 동작하는가?

### 공통(가독성/오버플로우)
- ✅ 시스템 글자 크기 크게/작게(접근성)에서 텍스트 잘림/레이아웃 오버플로우가 없는가?
- ✅ 작은 화면/큰 화면에서 주요 버튼·텍스트가 겹치지 않는가?

### 시나리오 1: 급여 입금 → 현금 자산에 추가

**테스트 단계:**

1. **거래 생성**
   - TransactionAddScreen 열기
   - 타입: `수입` 선택
   - 내용: "급여" 입력
   - 금액: "5,000,000" 입력
   - 저장 버튼 클릭

2. **자동 할당 대화상자 확인**
   - ✅ 다이얼로그가 나타나는가?
   - ✅ "옵션 1: 현금 추가만" 버튼이 보이는가?
   - ✅ "옵션 2: 지금 바로 분배하기" 버튼이 보이는가?

3. **옵션 1 선택: 현금 추가만**
   - "옵션 1: 현금 추가만" 버튼 탭
   - ✅ 화면이 자동으로 닫혀서 거래 목록으로 돌아가는가?
   - ✅ Snackbar "5,000,000원이 현금 자산에 추가되었습니다" 표시되는가?

4. **자산 확인**
   - AssetListScreen 열기
   - "현금" 자산 찾기
   - ✅ 현금 자산의 금액이 5,000,000 증가했는가?

5. **타임라인 확인**
   - "현금" 자산 탭해서 AssetDetailScreen 열기
   - ✅ "현재 잔액" 영역에 올바른 금액이 표시되는가?
   - ✅ "자산 이동 기록" 영역이 로드되는가?
   - ✅ "최초 보유" 항목이 보이는가?

---

### 시나리오 2: 급여 입금 → 지금 바로 분배하기

**테스트 단계:**

1. **거래 생성** (시나리오 1과 동일)
   - TransactionAddScreen 열기
   - 타입: `수입`
   - 내용: "월급"
   - 금액: "3,000,000"
   - 저장 클릭

2. **옵션 2 선택: 지금 바로 분배하기**
   - "옵션 2: 지금 바로 분배하기" 버튼 탭
   - ✅ IncomeSplitScreen으로 자동 이동하는가?

3. **분배 설정**
   - IncomeSplitScreen에서:
     - 저축: 30% (900,000원)
     - 예산: 40% (1,200,000원)
     - 비상금: 20% (600,000원)
     - 투자: 10% (300,000원)
   - 저장 버튼 클릭
   - ✅ Snackbar "분배 설정이 저장되었습니다" 표시되는가?

4. **자산 생성 확인**
   - AssetListScreen으로 돌아가기
   - ✅ 다음 자산들이 생성되었는가?
     - "현금" (3,000,000 증가)
     - "저축" (900,000)
     - "예산" (1,200,000)
     - "비상금" (600,000)
     - "투자" (300,000)

5. **AssetMove 기록 확인**
   - "현금" 자산 탭 → AssetDetailScreen
   - ✅ 타임라인에 4개의 이동 기록이 표시되는가?
     - 현금 → 저축 (900,000원, 수입 분배)
     - 현금 → 예산 (1,200,000원, 수입 분배)
     - 현금 → 비상금 (600,000원, 수입 분배)
     - 현금 → 투자 (300,000원, 수입 분배)

6. **각 자산 타임라인 확인**
   - "저축" 자산 → AssetDetailScreen
   - ✅ 타임라인에 "현금 → 저축" 이동 기록이 보이는가?
   - ✅ "현재 잔액" 900,000원이 맞는가?

---

## 버그 체크리스트

| 확인 항목 | 예상 결과 | 실제 결과 | 상태 |
|---------|---------|---------|------|
| _addToCashAsset() 호출 시 cash 자산 생성/찾기 | OK | ? | 🟡 |
| _addToCashAsset() 후 AssetDetailScreen 금액 반영 | 즉시 반영 | ? | 🟡 |
| _createAssetMovesForDistribution() AssetMove 생성 | 4개 생성 | ? | 🟡 |
| AssetMoveService.loadMoves() 호출 완료 확인 | 성공 | ? | 🟡 |
| 타임라인에 이동 기록 표시 | 최신순 정렬 | ? | 🟡 |
| 날짜 포맷 오류 | 해결됨 | ? | 🟡 |
| mounted 체크 | 안전 | ? | 🟡 |

---

## 예상 문제점 및 해결책

### 문제 1: AssetMove가 생성되지 않음
**원인:** `assetMoveService.addMove()` 호출이 실패
**해결:**
1. AssetMoveService._persist() 확인
2. SharedPreferences 권한 확인
3. 로그 추가: `debugPrint('AssetMove created: ${move.id}')`

### 문제 2: 타임라인이 비어 있음
**원인:** getMovesForAsset()가 AssetId 매칭 실패
**해결:**
1. AssetMove의 fromAssetId/toAssetId 정확성 확인
2. Asset.id 값 일치성 확인

### 문제 3: 현금 자산이 안 만들어짐
**원인:** AssetService.addAsset() 실패
**해결:**
1. try-catch에서 에러 메시지 확인
2. Asset 모델의 필수 필드 확인

---

## 테스트 순서

1. ✅ 빌드 성공 확인 (flutter analyze)
2. ✅ 앱 실행 (flutter run)
3. 시나리오 1 테스트 (현금 추가만)
4. 시나리오 2 테스트 (분배하기)
5. 전체 타임라인 확인
6. 에러 핸들링 테스트 (네트워크 끊김 등)

---

## 최종 결론 기준

**성공 조건:**
- 모든 시나리오 1, 2 단계가 성공하면 ✅ **현실 사용 가능**
- 타임라인에 4개 기록 + 금액이 정확하면 ✅ **자산 관리 완성**

**재작업 필요:**
- 타임라인 미표시 = 타임라인 로직 재검토
- 자산 미생성 = AssetService 재확인
