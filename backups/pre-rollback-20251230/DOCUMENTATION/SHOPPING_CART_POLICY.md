# Shopping Cart Policy (장바구니 변경 정책)

- 작성일: 2025-12-26
- 목적: 장바구니(쇼핑준비→장바구니→거래입력) 흐름은 **실사용 UX**와 **데이터 누적(학습/기억)**에 직결되므로, 임의 수정으로 회귀/데이터 손상을 방지한다.

## 1) 적용 범위 (Scope)
- 대상: 장바구니 관련 화면/로직 전체
  - `ShoppingCartScreen` (쇼핑준비 포함: `openPrepOnStart` 모드)
  - `ShoppingCartQuickTransactionScreen` (일괄 입력/빠른 거래)
  - 장바구니 관련 Prefs/키 (`UserPrefService`의 shopping quick / store defaults)
  - 장바구니 관련 유틸 (`shopping_cart_*`, `shopping_prep_utils` 등)

## 2) 변경 원칙 (Hard Rules)
- **지시사항/정책에 명시되지 않은 변경은 금지**
  - UI 배치, 입력 흐름, 정렬, 저장 키(Prefs key) 변경 포함
- 변경이 필요하면:
  1) 본 문서(또는 후속 정책 문서)에 **요구사항을 먼저 명문화**
  2) 수동 시나리오 + `flutter analyze` + `flutter test`를 통과
  3) INDEX 워크플로우(기록/검증/내보내기)를 수행

## 3) 보호해야 하는 핵심 동작 (Invariants)
- “현장 사용”을 전제로 한 빠른 조작이 최우선
  - 탭/체크 흐름이 느려지거나 팝업/추가 단계가 늘어나면 안 됨
- “기억(Defaults)”가 끊기면 안 됨
  - 마지막 결제수단/메모/카테고리, 상점별 기본값 등은 유지/확장만 가능
  - 기존 Prefs key를 임의로 변경하지 않는다(마이그레이션 없이 변경 금지)
- 가로/세로/작은 화면에서도 제품명/핵심 정보가 가려지면 안 됨

## 4) 현재 공식 지시사항 (TODO.md 기준)
아래 항목은 2025-12-26에 TODO.md에 기록된 **공식 개선 지시사항**이다.

### A. UI/레이아웃
1) **세로 화면**에서 제품명이 안 보이는 문제가 있어
   - `메모칸을 왼쪽으로 이동` 필요
5) **가로 화면**에서 제품명이 보이지 않음
   - 개선 필요

### B. 일괄입력(빠른 거래) 상태/기억
2) 일괄입력 화면에서 **카테고리를 몇 번 바꾸면 기억 상실**
   - “입력 내용 기억” 로직이 안정적으로 유지되도록 개선 필요

### C. 카테고리 선택 UX
3) 카테고리 추천 기능은 매우 좋음
   - 성능/정확도/동작 퇴보 금지(회귀 금지)
4) 카테고리 선택 터치 시
   - 선택 확정 후 **카테고리 창이 닫히게** 동작 재구성

## 5) 검증 체크리스트 (변경 시)
- 수동 시나리오
  - 세로 화면에서 제품명/핵심 정보 노출 확인
  - 가로 화면에서 제품명/핵심 정보 노출 확인
  - 일괄입력에서 카테고리 변경을 여러 번 반복해도 “기억 상실” 재현되지 않음을 확인
  - 카테고리 선택 시 즉시 확정 + 창 닫힘 동작 확인
  - 카테고리 추천은 기존 수준 유지(체감 저하/오작동 없을 것)
- 자동 검증
  - `flutter analyze --no-fatal-infos`
  - `flutter test`

## 6) 작업 착수 전 확인 질문(필수)
아래 2가지를 확정해야 코드 변경을 시작할 수 있다.
- (Q1) 1번(메모칸 왼쪽 이동)과 5번(가로 제품명) 해결 대상 화면은
  - `ShoppingCartScreen`의 리스트 타일인지
  - `ShoppingCartQuickTransactionScreen`의 폼/리스트인지
  - 둘 다인지
- (Q2) 2번(카테고리 기억 상실)의 기대 동작
  - “마지막으로 사용자가 확정한 카테고리”를 계속 유지하면 되는지
  - “품목별 카테고리”를 유지해야 하는지/or 상점별인지

