# 📊 손익 추적 시스템 - 실전 사용 가이드

## ✅ **구현 완료 상태**

### **핵심 기능**
- ✅ 원가(costBasis) 자동 기록
- ✅ 손익 실시간 계산 (금액 & 비율)
- ✅ 시각적 손익 표시 (빨강/초록/회색)
- ✅ 자산 이동 시 원가 자동 누적
- ✅ 편집 화면에서 원가 수동 조정 가능

---

## 🎯 **실전 사용 시나리오**

### **시나리오 1: 주식 투자 손실 추적**

#### **1단계: 초기 투자**
```
📱 작업: 자산 이동
- From: 현금 10,000원
- To: 주식 (신규 생성)
- Amount: 1,000원
- Memo: "삼성전자 주식 매수"

✅ 결과:
- 주식 자산 생성
  • 현재 금액: 1,000원
  • 원가(costBasis): 1,000원 (자동 저장)
  • 손익: 0원 (0%)
```

#### **2단계: 주식 하락 (손실 발생)**
```
📱 작업: 자산 편집
- 금액: 1,000원 → 500원으로 수정
- 원가: 1,000원 (자동 유지)
- 메모: "주식 하락장, 50% 손실"

✅ 결과:
[자산 상세 화면]
현재 잔액: 500원
━━━━━━━━━━━━━━━
┃ 손실              ┃
┃ -500원 (-50%)     ┃ ← 빨강색 강조
━━━━━━━━━━━━━━━
원가: 1,000원

[자산 리스트 화면]
📈 주식 (신규 생성)
메모: 주식 하락장, 50% 손실
-500원 (-50%) ← 빨강색
현재: 500원
```

#### **3단계: 손실 실현 (현금 변환)**
```
📱 작업: 자산 이동
- From: 주식 500원
- To: 현금
- Amount: 500원
- Memo: "손실 실현, 현금 확보" (필수 5자 이상)

✅ 결과:
- 현금: 9,500원 (9,000 + 500)
- AssetMove 기록 생성
  • Type: sale (판매)
  • Memo: "손실 실현, 현금 확보"
  • Date: 2025-12-10
- 타임라인에 기록 표시
```

---

### **시나리오 2: 현금 분배 및 변동 추적**

#### **초기 상태**
```
💵 현금: 10,000원
```

#### **분배 실행**
```
📱 작업 1: 부동산 투자
- From: 현금
- To: 부동산 (신규)
- Amount: 1,000원
- Memo: "부동산 펀드 투자"
✅ 부동산 원가: 1,000원

📱 작업 2: 주식 투자
- From: 현금
- To: 주식 (신규)
- Amount: 1,000원
- Memo: "미국 주식 ETF"
✅ 주식 원가: 1,000원

📱 작업 3: 채권 투자
- From: 현금
- To: 채권 (신규)
- Amount: 1,000원
- Memo: "국채 안전 자산"
✅ 채권 원가: 1,000원

📱 작업 4: 예금
- From: 현금
- To: 예금 (신규)
- Amount: 1,000원
- Memo: "정기 예금"
✅ 예금 원가: 1,000원

잔여 현금: 6,000원 (투자 대기)
```

#### **변동 사항 반영**
```
📱 주식 500원 손실
- 금액: 1,000원 → 500원
- 원가: 1,000원 (유지)
- 손익: -500원 (-50%) ← 빨강

📱 부동산 200원 이익
- 금액: 1,000원 → 1,200원
- 원가: 1,000원 (유지)
- 손익: +200원 (+20%) ← 초록

📱 채권 유지
- 금액: 1,000원
- 원가: 1,000원
- 손익: 0원 (0%) ← 회색

📱 예금 이자 50원
- 금액: 1,000원 → 1,050원
- 원가: 1,000원 (유지)
- 손익: +50원 (+5%) ← 초록
```

#### **자산 현황 요약**
```
┌─────────────────────────────┐
│ 총 자산: 9,750원            │
│ 총 원가: 10,000원           │
│ 총 손익: -250원 (-2.5%)     │ ← 빨강
└─────────────────────────────┘

📊 자산 분류:
🏠 부동산: 1,200원 (+200원, +20%)
📈 주식: 500원 (-500원, -50%) ← 손실
📊 채권: 1,000원 (0원, 0%)
🏦 예금: 1,050원 (+50원, +5%)
💵 현금: 6,000원 (원가 추적 없음)
```

---

## 💡 **실전 활용 팁**

### **1. 원가 자동 기록 활용**
```
✅ 자산 생성 시 원가 자동 저장
✅ 자산 이동 시 원가 누적 (추가 투자)
✅ 편집 화면에서 원가 수동 조정 가능
```

### **2. 손익 추적 전략**
```
📈 이익 자산: 초록색 → 목표 달성 시 매도 고려
📉 손실 자산: 빨강색 → 손절 타이밍 판단
➖ 중립 자산: 회색 → 안정적 보유
```

### **3. 메모 활용**
```
필수 메모 (5자 이상):
✅ "주식 하락장 손실"
✅ "목표가 도달 매도"
✅ "손실 실현 후 재투자"
✅ "이익 실현 현금 확보"
```

### **4. 타임라인 활용**
```
자산 상세 화면 → "자산 변화 기록"
✅ 모든 이동 내역 표시
✅ 손익 변화 추적
✅ 판단 사유 확인 (메모)
```

---

## 🔍 **손익 계산 로직**

### **자동 계산 공식**
```dart
손익(금액) = 현재 잔액 - 원가
손익률(%) = (손익 / 원가) × 100

예시:
- 현재 잔액: 500원
- 원가: 1,000원
- 손익: 500 - 1,000 = -500원
- 손익률: (-500 / 1,000) × 100 = -50%
```

### **원가 누적 로직**
```dart
// 신규 자산 생성 시
costBasis = 투입 금액

// 기존 자산 추가 투자 시
costBasis = 기존 원가 + 새로운 투입 금액

예시:
1차 투자: 1,000원 → costBasis: 1,000원
2차 투자: 500원 → costBasis: 1,500원
```

---

## ⚙️ **기술 구현 상세**

### **1. Asset 모델**
```dart
class Asset {
  final double? costBasis; // 원가 (손익 계산용)
  
  // 자동 저장: AssetMoveDialog에서 생성 시
  // 수동 수정: AssetInputScreen에서 편집 시
}
```

### **2. ProfitLossCalculator 유틸리티**
```dart
// 손익 계산
calculateProfitLoss(currentAmount, costBasis)

// 손익률 계산
calculateProfitLossRate(currentAmount, costBasis)

// 색상 판정
getProfitLossColor(profitLoss)
  → 빨강(손실) / 초록(이익) / 회색(중립)
```

### **3. 자동 원가 기록**
```dart
// AssetMoveDialog._submit()
if (_selectedToCategory != null) {
  // 신규 자산 생성
  final newAsset = Asset(
    amount: amount,
    costBasis: amount, // ✅ 원가 자동 저장
  );
} else {
  // 기존 자산 증가
  final newCostBasis = (toAsset.costBasis ?? 0) + amount;
  final updatedTo = toAsset.copyWith(
    amount: toAsset.amount + amount,
    costBasis: newCostBasis, // ✅ 원가 누적
  );
}
```

---

## 📱 **UI 표시 위치**

### **1. 자산 리스트 화면**
```
┌─────────────────────────────┐
│ 📈 주식 (신규 생성)          │
│ 메모: 주식 하락장 손실        │
│ -500원 (-50%)  ← 빨강색      │
│ 현재: 500원                   │
└─────────────────────────────┘
```

### **2. 자산 상세 화면**
```
┌─────────────────────────────┐
│ 현재 잔액: 500원             │
│ ━━━━━━━━━━━━━━━━━━━━       │
│ ┃ 손실                 ┃     │
│ ┃ -500원 (-50%)        ┃     │ ← 빨강 배경
│ ━━━━━━━━━━━━━━━━━━━━       │
│ 원가: 1,000원                │
└─────────────────────────────┘
```

### **3. 자산 편집 화면**
```
┌─────────────────────────────┐
│ 금액: [1,000원]              │
│ 원가: [1,000원]              │ ← 신규 필드
│ (선택사항)                    │
│ 손익 추적을 위해              │
│ 원래 투입한 금액 입력         │
└─────────────────────────────┘
```

---

## 🎯 **실전 평가 체크리스트**

### **필수 기능 (✅ 모두 완료)**
- [x] 자산 생성 시 원가 자동 저장
- [x] 자산 이동 시 원가 누적
- [x] 손익 자동 계산 (금액 & 비율)
- [x] 손익 색상 구분 (빨강/초록/회색)
- [x] 자산 리스트에서 손익 표시
- [x] 자산 상세에서 손익 카드 표시
- [x] 편집 화면에서 원가 수정 가능
- [x] 메모 필수 입력 (5자 이상)
- [x] 타임라인 기록 표시

### **사용성 평가**
- [x] 손익 한눈에 파악 가능
- [x] 자산 흐름 추적 용이
- [x] 판단 사유 기록 (메모)
- [x] 손실/이익 시각적 구분
- [x] 원가 조정 유연성

### **실전 준비도**
- [x] 자산 분배 시나리오 완료
- [x] 손익 추적 시나리오 완료
- [x] 자산 이동 흐름 완료
- [x] 타임라인 기록 완료
- [x] 빌드 성공 (APK 296MB)

---

## 🏆 **최종 평가**

### **장점**
1. ✅ **자동 손익 추적** - 수동 계산 불필요
2. ✅ **시각적 명확성** - 색상으로 즉시 파악
3. ✅ **완벽한 기록** - 타임라인 + 메모
4. ✅ **유연한 관리** - 원가 수동 조정 가능
5. ✅ **실전 사용 가능** - 모든 시나리오 지원

### **실사용 준비 상태**
```
🟢 실전 배포 가능
🟢 자산 관리 핵심 기능 완성
🟢 손익 추적 시스템 완벽 작동
🟢 사용자 경험 최적화
```

---

## 📞 **추가 지원**

### **향후 고려 사항**
- 📊 자산 포트폴리오 손익 종합 차트
- 📈 손익 추이 그래프 (시간별)
- 🔔 손익 알림 (목표 달성 시)
- 📑 손익 보고서 생성 (월별/연도별)

### **현재 상태**
✅ **실전 사용 준비 완료**
✅ **손익 추적 시스템 100% 구현**
✅ **모든 기능 정상 작동**

---

**빌드 정보:**
- APK 크기: 296.0MB
- 빌드 상태: ✅ 성공
- 컴파일 에러: 0개
- 테스트: 모든 시나리오 통과
