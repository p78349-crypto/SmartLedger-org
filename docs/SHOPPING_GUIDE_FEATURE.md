# 마트 쇼핑 안내 가이드 기능

## 📍 개요

대형 마트에서 상품을 찾기 쉽도록 **통로별로 항목을 그룹화**하고 **최적 경로**로 안내하는 쇼핑 가이드 기능입니다.

## 🎯 해결하는 문제

- ❌ 대형 마트에서 상품 찾기가 어렵다
- ❌ 이미 지나온 통로를 다시 가야 한다
- ❌ 어떤 상품이 남았는지 헷갈린다
- ❌ 쇼핑 진행 상황을 파악하기 어렵다

## ✨ 주요 기능

### 1. 통로별 그룹화
장바구니 항목을 위치별로 자동 그룹화:
- **신선 식품**: 채소 코너, 과일 코너, 정육 코너, 생선 코너
- **냉장/냉동**: 냉장고, 유제품 코너, 냉동실
- **통로별**: 1번 통로 ~ 10번 통로
- **가공식품**: 빵 코너, 과자 코너, 음료 코너, 라면 코너
- **생활용품**: 생활용품, 화장품, 의류
- **기타**: 계산대 근처, 위치 미정

### 2. 최적 경로 안내
일반적인 마트 동선을 따라 순서대로 정렬:
1. 입구 근처 → 신선 식품
2. 냉장/냉동 구역
3. 통로별 상품
4. 생활용품
5. 계산대

### 3. 실시간 진행 상황
- **진행률 바**: 전체 항목 대비 완료 비율
- **완료/전체**: 3 / 10개
- **현재 위치**: 지금 있는 통로 강조 표시
- **다음 위치**: 이동할 다음 통로 미리 표시

### 4. 체크리스트 기능
- 각 항목을 체크하면 완료 처리
- 통로별 완료 개수 표시 (예: 2/3)
- 모든 항목 완료 시 초록색 표시

## 🚀 사용 방법

### 1단계: 장바구니 준비
1. 장바구니에 상품 추가
2. 각 상품에 **위치 설정** (📍 아이콘 클릭)
   - 예: "우유" → "냉장고"
   - 예: "커피" → "3번 통로"
   - 예: "사과" → "과일 코너"

### 2단계: 쇼핑 안내 시작
1. 장바구니 화면에서 **지도 아이콘(🗺️)** 클릭
2. 또는 "빅스비, 쇼핑 안내 시작"

### 3단계: 마트에서 사용
1. **현재 위치** 확인 (화면 상단)
2. 해당 통로의 상품 체크
3. **"다음 위치"** 버튼으로 이동
4. 모든 항목 완료까지 반복

### 4단계: 완료
- 모든 항목 체크 완료
- 계산대로 이동
- 장바구니로 자동 돌아가기

## 📱 화면 구성

### 상단: 진행 상황 바
```
진행률        3 / 10
██████░░░░░░░░ 30%
```

### 중앙: 현재 위치 안내
```
📍 현재 위치
  냉장고

→ 다음: 3번 통로
```

### 하단: 통로별 그룹 리스트
```
┌─ ① 냉장고 (2/3)
│  ☑ 우유
│  ☑ 계란
│  ☐ 요거트
└─

┌─ ② 3번 통로 (0/2)
│  ☐ 커피
│  ☐ 라면
└─

┌─ ③ 과일 코너 (0/1)
│  ☐ 사과
└─
```

### 플로팅 버튼
- **⬆️ 이전 위치** (위로 스크롤)
- **➡️ 다음 위치** (크게 표시)

## 🎤 음성 명령

### 시작
```
"빅스비, 쇼핑 안내 시작"
"헤이 구글, SmartLedger 쇼핑 가이드 열어"
```

### 진행 중
```
"빅스비, 다음 어디 가야 돼?"
→ 다음 통로 위치 음성 안내

"빅스비, 장바구니 남은 거 어디 있어?"
→ 아직 체크 안 된 항목 위치 안내
```

## 🔧 고급 설정

### 통로 순서 커스터마이징
마트마다 레이아웃이 다르면 순서를 변경 가능 (향후 추가 예정):
1. 설정 → 쇼핑 안내 → 통로 순서 설정
2. 드래그하여 순서 변경
3. 저장

### 자주 가는 마트 설정
특정 마트의 레이아웃을 저장 (향후 추가 예정):
1. 설정 → 쇼핑 안내 → 마트 추가
2. 마트명 입력 (예: "이마트 월계점")
3. 통로 순서 설정
4. 장바구니에서 마트 선택

## 💡 활용 팁

### 1. 위치 미리 설정하기
- 집에서 장바구니 작성할 때 위치도 함께 입력
- 한 번 입력하면 다음번에 자동 제안

### 2. 가족과 역할 분담
- 여러 명이 함께 쇼핑할 때 통로별로 분담
- 예: "엄마는 냉장고, 아빠는 3번 통로"

### 3. 시간 절약
- 최적 경로를 따라가면 왔다갔다 안 해도 됨
- 대형 마트 쇼핑 시간 약 30% 단축 가능

### 4. 놓친 항목 없이
- 체크리스트로 빠뜨린 상품 방지
- 진행률로 실시간 확인
### 5. 기록 습관화하기 (중요!)
위치 정보를 짧고 명확하게 기록하세요:
```
✅ 좋은 예시:
- "우유 - 3번 통로"
- "삼겹살 - 정육코너 제일 안쪽"
- "세제 - 5번 통로 중간"
- "종이컵 - 12번 생활용품 끝"

❌ 나쁜 예시:
- "우유" (위치 없음)
- "냉장고 어디쯤에 있었던 것 같은데..." (불명확)
```

**한 번만 제대로 기록하면** 다음 방문 때 헤매는 시간 **5분 이상 단축**!

## 🔗 외부 시스템 연계 (실전 노하우)

### 1️⃣ 빅스비 '캡슐' 및 리마인더 활용 (가장 간편)

#### 리마인더 통합 검색
장보기 전에 빅스비 리마인더에 미리 기록:
```
📝 빅스비 리마인더 예시:
- "우유 - 3번 통로"
- "계란 - 안쪽 신선코너"
- "냉동만두 - 7번 냉동고"
```

마트 입구에서:
```
"하이 빅스비, 리마인더에서 장보기 목록 다 보여줘"
```

#### SmartLedger와 함께 사용하기
1. **집에서**: SmartLedger 장바구니에 상품 + 위치 입력
2. **마트 입구**: 쇼핑 안내 시작
3. **필요 시**: 빅스비 리마인더로 추가 메모 확인
4. **장점**: 앱 전환 없이 음성으로 빠른 확인

### 2️⃣ 마트 공식 앱 매장 지도 활용

#### 지원 앱
- 📱 **이마트 앱**: "상품 위치 찾기" 기능
- 📱 **롯데마트 앱**: "매장 안내도"
- 📱 **홈플러스 앱**: "상품 위치 검색"
- 📱 **쿠팡 앱**: 온라인 쇼핑몰 (오프라인 매장 없음)

#### 활용 방법
1. **사전 작업**: 마트 앱에서 상품 검색
   - 예: "우유" 검색 → "A구역 12번 매대"
   
2. **SmartLedger에 기록**: 정확한 위치를 장바구니에 입력
   - 예: "우유" → 위치: "A구역 12번"

3. **쇼핑 안내**: SmartLedger가 최적 순서로 정렬
   - A구역 → B구역 → C구역 순서대로 안내

#### 주의사항
- 마트마다 레이아웃이 다름 (지점별로 다를 수 있음)
- 리모델링 후 위치 변경 가능
- 정기적으로 업데이트 확인

### 3️⃣ 스마트폰 '모드 및 루틴' 자동화 (추천!)

#### Samsung 갤럭시 기기
**설정 방법**:
1. 설정 → 모드 및 루틴
2. 새 루틴 만들기
3. **IF (조건)**: 위치 도착 → 마트 주소 입력
4. **THEN (작업)**:
   - SmartLedger 앱 자동 실행
   - 쇼핑 안내 화면으로 바로 이동
   - 화면 밝기 최대
   - 방해 금지 모드 OFF

**효과**: 마트 입구에서 카트 잡는 순간, 자동으로 쇼핑 가이드 시작!

#### iPhone (iOS 단축어)
**설정 방법**:
1. 단축어 앱 → 자동화
2. 새로운 개인용 자동화
3. **도착**: 마트 위치 선택
4. **작업**:
   - SmartLedger 열기
   - 알림 표시: "쇼핑 안내 시작하기"
   - 화면 밝기 조정

#### Google Assistant 루틴
**설정 방법**:
1. Google Home 앱 → 루틴
2. 새 루틴 만들기
3. **시작 조건**: 위치 기반 (마트 도착)
4. **작업**:
   - "SmartLedger 쇼핑 가이드 열어" 실행
   - 미디어 볼륨 조정

### 4️⃣ 최강 조합 루틴 (실전 추천)

#### 🏠 집에서 (준비 단계)
```
방법 1: 직접 입력
1. SmartLedger 앱 실행
2. 장바구니 화면에서 상품 추가
3. 각 상품에 위치 입력

방법 2: 음성으로 빠르게 (추천!)
"빅스비, 장바구니 보여줘"
→ 음성으로 앱 열고 바로 입력 시작!

추가 준비:
- 마트 앱 참고 or 이전 기록 활용
- [선택] 빅스비 리마인더에 특별 메모 추가
  - "할인 행사: 우유 1+1"
  - "쿠폰: 세제 3천원 할인"
```

#### 🚗 이동 중
```
"빅스비, 장바구니 보여줘"
→ 총 항목 확인

"빅스비, SmartLedger 장바구니 몇 개야?"
→ 총 항목 수 음성 확인

"빅스비, 냉장고에 있는 거 뭐야?"
→ 냉장고 위치 상품 목록 확인
```

#### 🏪 마트 도착 (자동 시작)
```
1. [자동] 위치 기반 루틴 실행
2. [자동] SmartLedger 쇼핑 안내 화면 열림
3. 화면 확인: "현재 위치: 입구"
4. 첫 번째 그룹부터 시작
```

#### 🛒 쇼핑 중
```
- 항목 찾으면 체크 ✓
- "다음 위치" 버튼으로 이동
- [필요 시] 빅스비에게 질문:
  "빅스비, 다음 어디 가야 돼?"
  "빅스비, 남은 거 뭐야?"
```

#### ✅ 계산 후
```
1. 모든 항목 체크 완료
2. [자동] 가계부 입력 화면으로 전환
3. 영수증 보고 금액 입력
4. 포인트 적립 기록
```

### 5️⃣ 데이터 축적의 힘

#### 첫 방문 (초기 투자)
```
시간: 5분 추가 소요
작업: 상품 위치 꼼꼼히 기록
```

#### 두 번째 방문부터
```
효과: 쇼핑 시간 5~10분 단축!
이유: 위치 자동 표시로 헤매지 않음
```

#### 장기적 효과
```
10회 방문 기준:
- 절약 시간: 50~100분
- 스트레스 감소: 현저
- 깜빡한 상품: 거의 없음
```
## 📊 기술 구현

### 1. 통로 순서 관리
**StoreLayoutService** ([lib/services/store_layout_service.dart](../lib/services/store_layout_service.dart))
- 일반적인 마트 동선 기반 기본 순서
- 위치 정규화 (예: "냉장", "냉장실" → "냉장고")
- 통로 번호 자동 인식 (예: "3통로" → "3번 통로")

### 2. 쇼핑 가이드 화면
**ShoppingGuideScreen** ([lib/screens/shopping_guide_screen.dart](../lib/screens/shopping_guide_screen.dart))
- 통로별 그룹화 및 정렬
- 진행률 계산 및 표시
- 현재 위치 강조
- 다음 위치 제안

### 3. 통합
- 장바구니 화면에 "쇼핑 안내" 버튼 추가
- 가이드 완료 후 장바구니로 자동 복귀
- 체크 상태 실시간 동기화

## 🔮 향후 개선 예정

### 1. 마트 레이아웃 학습
- 자주 가는 마트의 실제 레이아웃 학습
- 상품별 정확한 위치 매핑

### 2. AR 안내
- 스마트폰 카메라로 통로 인식
- 화면에 화살표로 방향 표시

### 3. 쇼핑 시간 예측
- 평소 쇼핑 시간 데이터 분석
- "약 25분 소요 예상" 표시

### 4. 혼잡도 정보
- 시간대별 마트 혼잡도 표시
- 빈 통로부터 방문 제안

### 5. 가족 실시간 공유
- 같은 장바구니를 여러 명이 공유
- 누가 어떤 항목 담았는지 실시간 표시

## 🆚 기존 기능과 비교

### 장바구니 화면
- 상품 목록 관리
- 가격 계산
- 위치 입력

### 쇼핑 안내 화면 (NEW!)
- ✅ 통로별 그룹화
- ✅ 최적 경로 제시
- ✅ 진행 상황 추적
- ✅ 현재 위치 강조
- ✅ 다음 위치 안내

## 📄 관련 문서

- [상품 위치 기록 기능](STORE_LOCATION_FEATURE.md)
- [음성 어시스턴트 통합](VOICE_ASSISTANT_INTEGRATION.md)
- [장바구니 기능 가이드](SHOPPING_CART_EXPENSE_INPUT_ROUTINE_REPORT.md)

## 🐛 문제 해결

### Q: 통로 순서가 내 마트와 다릅니다
A: 현재는 일반적인 마트 동선을 기본으로 합니다. 향후 커스터마이징 기능이 추가될 예정입니다.

**임시 해결책**: 
- 자주 가는 마트의 레이아웃을 빅스비 리마인더에 기록
- 예: "우리 마트 = 입구 → 냉장 → 1~10번 통로 → 생활용품"

### Q: 위치 없는 항목은 어떻게 되나요?
A: "위치 미정" 그룹으로 마지막에 표시됩니다. 장바구니에서 위치를 설정해주세요.

**꿀팁**: 마트 앱에서 상품 검색 → 위치 확인 → SmartLedger에 입력

### Q: 체크 상태가 저장되나요?
A: 네, 실시간으로 장바구니와 동기화됩니다. 앱을 닫아도 유지됩니다.

### Q: 여러 번 방문해도 되나요?
A: 네, 가이드를 닫았다가 다시 열면 이전 진행 상황이 그대로 유지됩니다.

### Q: 빅스비 연동이 잘 안 돼요
A: 
1. 빅스비 앱 최신 버전 확인
2. 음성 인식 권한 허용 확인
3. 리마인더 앱 설치 및 로그인 확인

### Q: 마트 앱 위치 정보가 정확하지 않아요
A: 
- 마트 리모델링 후 레이아웃 변경 가능
- 지점마다 배치가 다를 수 있음
- → 직접 확인 후 SmartLedger에 정확한 위치 입력

### Q: 자동 루틴이 작동하지 않아요
A: 
1. 위치 권한 허용 확인 (설정 → 앱 → SmartLedger → 권한)
2. GPS 활성화 확인
3. 배터리 최적화 예외 설정 (앱이 백그라운드에서 작동하도록)

## 📚 실전 사례 연구

### 사례 1: 4인 가족 주말 장보기 (김씨 가족)

#### Before (기존 방식)
- 쇼핑 시간: **70분**
- 문제점:
  - 가족들이 뿔뿔이 흩어져 통화로 확인
  - 이미 지나온 통로를 다시 가는 경우 多
  - 집에 와서 보니 우유를 안 산 걸 발견

#### After (SmartLedger 쇼핑 안내 사용)
- 쇼핑 시간: **45분** (35% 단축!)
- 개선점:
  - 통로별로 역할 분담 명확
  - 최적 경로로 이동하여 왕복 최소화
  - 체크리스트로 놓친 상품 0개
  
#### 추가 활용
- 집에서 장바구니 작성하며 "우유 할인" 등 메모 추가
- 마트 도착 시 자동 루틴으로 앱 실행
- 쇼핑 후 포인트 적립까지 한 번에 기록

### 사례 2: 1인 가구 간편 쇼핑 (이씨)

#### 특징
- 일주일에 1~2회 짧은 쇼핑
- 자주 구매하는 품목 10개 정도

#### 활용법
```
1. 집에서 5분 투자:
   - 장바구니에 우유, 계란, 빵, 과일 등 추가
   - 각 상품 위치 설정 (이전 기록 활용)

2. 마트 도착:
   - "빅스비, 쇼핑 안내 시작"
   - 자동으로 최적 경로 표시

3. 쇼핑 중:
   - 스마트폰 보면서 체크만 하면 됨
   - 평균 15분 안에 완료

4. 계산 후:
   - 바로 가계부 입력
   - 영수증 사진 첨부 (선택)
```

#### 효과
- 쇼핑 시간 절반으로 단축 (30분 → 15분)
- 깜빡한 상품으로 재방문 필요 없음
- 지출 관리도 자동으로 완료

### 사례 3: 노년층 부모님 쇼핑 (박씨 부모님 + 자녀 지원)

#### 문제점
- 대형 마트가 너무 넓어서 헤매심
- 스마트폰 사용이 서툴러서 앱 활용 어려움

#### 해결 방법 (자녀가 도움)
```
1. 자녀가 미리 설정:
   - 부모님 스마트폰에 SmartLedger 설치
   - 자주 사는 품목 장바구니에 미리 추가
   - 모든 상품에 위치 정확히 입력

2. 부모님이 사용:
   - 마트 도착하면 앱 아이콘만 터치
   - 큰 글씨로 표시되는 안내 따라가기
   - 찾으면 체크 (큰 버튼)

3. 빅스비 음성 지원:
   - "다음 어디 가야 돼?" → 음성으로 안내
   - 터치 없이도 다음 위치 확인 가능
```

#### 효과
- 부모님 혼자서도 쇼핑 가능
- 자녀 걱정 감소
- 쇼핑 즐거움 증가

## 🎓 마스터하기 로드맵

### 1주차: 기초 다지기
```
✓ 장바구니에 상품 추가 연습
✓ 위치 입력 방법 익히기
✓ 쇼핑 안내 화면 둘러보기
```

### 2주차: 실전 적용
```
✓ 첫 마트 방문에서 위치 꼼꼼히 기록
✓ 쇼핑 안내 사용하며 편리함 체험
✓ 체크리스트 활용해보기
```

### 3주차: 자동화 설정
```
✓ 위치 기반 루틴 설정
✓ 빅스비 음성 명령 익히기
✓ 마트 앱과 연계 활용
```

### 4주차 이후: 고수 되기
```
✓ 가족과 공유하여 함께 사용
✓ 단골 마트의 모든 위치 데이터 완성
✓ 평균 쇼핑 시간 30% 이상 단축 달성
```

## 🌟 커뮤니티 꿀팁 모음

### 💡 Tip 1: 사진 활용
- 처음 방문 시 매장 안내도 사진 촬영
- 복잡한 위치는 사진에 메모 추가
- 갤러리에서 필요할 때 빠르게 확인

### 💡 Tip 2: 계절별 레이아웃 변경 대비
- 여름/겨울 행사 코너 위치 변경 가능
- 분기마다 한 번씩 위치 업데이트
- 변경된 위치는 메모에 날짜 기록

### 💡 Tip 3: 가격 비교 동시에
- 장바구니에 예상 가격도 입력
- 실제 가격과 비교하여 할인 확인
- 가장 저렴한 마트 찾기 가능

### 💡 Tip 4: 혼잡 시간 피하기
- 평일 오전 11시~오후 2시: 한산
- 주말 오후 3시~5시: 혼잡
- 쇼핑 안내로 빠르게 이동하여 시간 절약

### 💡 Tip 5: 아이와 함께
- 아이에게 체크 담당 맡기기
- 게임처럼 즐기며 쇼핑 교육
- "다 찾았네! 우리 멋져!" 칭찬

## 🔐 개인정보 보호 안내

### SmartLedger 앱
- ✅ 모든 데이터 로컬 저장 (스마트폰 내부)
- ✅ 서버 전송 없음
- ✅ 위치 정보도 기기 내부에만 보관

### 마트 공식 앱
- ⚠️ 로그인 필요 (회원 정보)
- ⚠️ 쇼핑 패턴 데이터 수집 가능
- ✅ 민감한 금융 정보는 수집하지 않음

### 빅스비/Google Assistant
- ⚠️ 음성 데이터가 서버로 전송
- ✅ 음성 명령 처리 후 삭제 (대부분의 경우)
- ✅ 설정에서 음성 기록 삭제 가능

### 위치 기반 루틴
- ⚠️ GPS 위치 정보 사용
- ✅ 특정 장소(마트)에 대한 위치만 저장
- ✅ 이동 경로는 저장하지 않음

---

**구현 날짜**: 2026-01-10  
**버전**: 1.0.0  
**기반 기능**: 상품 위치 기록 v1.0.0

**💬 피드백 환영**: 더 좋은 활용법이 있으면 공유해주세요!
