# 날씨 예보 기반 사전 장보기 시스템

## 개요

극한 날씨(태풍, 폭우, 폭설, 한파) **발생 전에** 미리 장보기를 유도하여 가격 폭등 전에 필수 품목을 확보하도록 돕는 시스템입니다.

**핵심 가치:**
- 💰 **비용 절감**: 가격 폭등 전 미리 구매하여 수만 원 절약
- 🛡️ **안전 확보**: 생수, 손전등 등 안전용품 사전 준비
- 🥬 **신선식품 확보**: 배추, 계란 등 품귀 현상 전 확보
- ⏰ **타이밍 알림**: "지금 즉시", "오늘 안에" 등 구체적 시점 제시

---

## 음성 명령어

### 1. 장보기 리스트 생성

#### 날씨 예보 확인 후 자동 생성
```
빅스비, 태풍 장보기
빅스비, 한파 준비 쇼핑
빅스비, 폭우 전 장보기
빅스비, 폭설 대비 쇼핑
```

**응답 예시 (태풍 3일 전):**
```
🚨 태풍 3일 후 예상! 오늘 안에 장보기 필수!

긴급 품목 5개 포함 총 8개 준비하세요.

쇼핑 리스트:
🚨 생수 20리터 (6,000원) - 단수 가능성
🚨 배추 2포기 (6,000원) - 태풍 후 +20% 예상
🚨 사과 10개 (15,000원) - 낙과로 공급 감소
🚨 손전등 2개 (30,000원) - 정전 대비
🚨 건전지 10개 (5,000원) - 손전등용
▫️ 라면 15개 (12,000원) - 간편식
▫️ 통조림 10개 (20,000원) - 장기 보관
▫️ 구급약 1세트 (20,000원) - 부상 대비

총 8개 품목, 예상 비용 114,000원
미리 사면 약 18,000원 절약 가능합니다!

지금 장보러 가시겠습니까?
```

### 2. 긴급도별 명령어

#### 당일/내일 (긴급)
```
빅스비, 지금 장보기
빅스비, 급하게 장봐야해
빅스비, 내일 태풍인데
```

#### 3~5일 전 (여유)
```
빅스비, 이번 주 장보기
빅스비, 미리 장보기
```

### 3. 가족 수 반영

```
빅스비, 4인 가족 장보기
빅스비, 혼자 사는데 준비
```

**응답 예시 (4인 가족):**
```
4인 가족 기준으로 계산합니다.

- 생수 40리터 (2배)
- 배추 4포기 (2배)
- 라면 30개 (2배)
...
```

---

## 긴급도 등급 시스템

| 며칠 전 | 긴급도 | 메시지 | 색상 |
|---------|--------|--------|------|
| **당일** | 5 (최고) | "지금 즉시" | 🔴 빨강 |
| **1일 전 (내일)** | 4 | "오늘 안에" | 🟠 주황 |
| **2일 전 (모레)** | 3 | "내일까지" | 🟡 노랑 |
| **3~4일 전** | 2 | "이번 주 안에" | 🔵 파랑 |
| **5일 이상** | 1 | "여유있게" | 🟢 초록 |

---

## 쇼핑 리스트 우선순위

### 우선순위 계산식
```
우선순위 = 카테고리 가중치 + 긴급도 가중치 + 시간 가중치
```

### 카테고리별 가중치

| 순위 | 카테고리 | 가중치 | 이유 |
|------|----------|--------|------|
| 1 | 안전용품 | +0.30 | 생명과 직결 |
| 2 | 물 | +0.25 | 필수 생존 자원 |
| 3 | 신선식품 | +0.20 | 가격 변동 큼 |
| 4 | 의약품 | +0.15 | 건강 관리 |
| 5 | 비축식품 | +0.10 | 장기 보관 |
| 6 | 에너지 | +0.05 | 난방 등 |

### 긴급도 가중치
- 긴급도 5: +0.5
- 긴급도 4: +0.4
- 긴급도 3: +0.3
- 긴급도 2: +0.2
- 긴급도 1: +0.1

### 시간 가중치
- 1일 이내: +0.2
- 2일 이내: +0.1

---

## 예상 절약액 계산

### 계산 방식
```
절약액 = Σ (신선식품 현재가격 × 예상상승률)

예상상승률 = 날씨 민감도 × 20%
```

### 예시 (태풍 3일 전)

| 품목 | 현재가격 | 민감도 | 예상상승률 | 절약액 |
|------|----------|--------|-----------|--------|
| 배추 2포기 | 6,000원 | 1.0 | +20% | 1,200원 |
| 사과 10개 | 15,000원 | 1.0 | +20% | 3,000원 |
| 고등어 5마리 | 15,000원 | 1.0 | +20% | 3,000원 |
| 오이 10개 | 5,000원 | 0.9 | +18% | 900원 |
| **합계** | **41,000원** | - | - | **8,100원** |

---

## 실제 사용 시나리오

### 시나리오 1: 태풍 3일 전

**사용자:** "빅스비, 태풍 장보기"

**빅스비:**
```
🚨 태풍 3일 후 예상! 오늘 안에 장보기 필수!

쇼핑 리스트 (우선순위 순):
1. 🚨 생수 20리터 - 단수 가능성
2. 🚨 손전등 2개 - 정전 대비
3. 🚨 배추 2포기 - 태풍 후 가격 2배 예상
4. 🚨 사과 10개 - 낙과로 공급 감소
5. 건전지 10개
6. 라면 15개
7. 통조림 10개
8. 구급약 1세트

총 예상 비용: 114,000원
미리 사면 18,000원 절약!

지금 장보러 가시겠습니까?
```

**사용자 행동:**
- "응" 또는 화면에서 "지금 장보러 가기" 버튼 터치
- 쇼핑 리스트 화면 표시
- 체크박스로 구매 완료 표시
- 모두 체크하면 "장보기 완료!" 축하 메시지

### 시나리오 2: 한파 당일 (긴급)

**사용자:** "빅스비, 지금 장보기"

**빅스비:**
```
❄️ 한파 특보! 지금 즉시 장보기 필수!

긴급 품목:
1. 🚨 핫팩 20개 - 저체온증 예방
2. 🚨 계란 30개 - 조류독감 전 확보 (지금 안 사면 2배!)
3. 🚨 배추 2포기 - 한파로 생육 저하
4. 🚨 생수 15리터 - 수도관 동파

총 4개 긴급 품목, 30분 내 구매 권장!
예상 절약액: 12,000원

마트 어디로 갈까요?
```

### 시나리오 3: 장마철 1주일 전 (여유)

**사용자:** "빅스비, 장마 준비"

**빅스비:**
```
🌧️ 장마철 7일 후 시작 예상. 이번 주 안에 준비하시면 됩니다.

채소값 폭등 전 확보:
- 배추 2포기 (현재 6,000원 → 장마 후 7,200원)
- 양배추 2개 (현재 5,000원 → 장마 후 5,900원)
- 오이 10개 (현재 5,000원 → 장마 후 5,900원)

수산물:
- 고등어 5마리 (조업 중단 예상)

총 절약 예상액: 15,000원

여유있게 준비하세요!
```

---

## UI 화면 구성

### 1. 쇼핑 리스트 화면

**상단 배너:**
```
┌─────────────────────────────────────┐
│ 🚨 태풍 3일 후 예상!                 │
│ 오늘 안에 장보기 필수!                │
│ 긴급 품목 5개 포함 총 8개 준비       │
└─────────────────────────────────────┘
```

**요약 카드:**
```
┌─────────────────────────────────────┐
│ 진행률: 3/8          37.5%           │
│ ████████░░░░░░░░░░░░                │
│                                     │
│ 예상 비용        예상 절약           │
│ 114,000원        18,000원           │
└─────────────────────────────────────┘
```

**체크리스트:**
```
☑ 🌊 생수 20리터         6,000원
   단수 가능성
   
☑ 🛡️ 손전등 2개         30,000원
   정전 대비
   
☐ 🥬 배추 2포기 [긴급]   6,000원
   태풍 후 +20% 예상
   
☐ 🍎 사과 10개 [긴급]    15,000원
   낙과로 공급 감소
```

**하단 바:**
```
┌─────────────────────────────────────┐
│ 3개 선택됨        [장보기 완료] ▶    │
└─────────────────────────────────────┘
```

### 2. 완료 다이얼로그

```
┌─────────────────────────────────┐
│  🎉 장보기 완료!                 │
│                                 │
│  모든 품목을 구매하셨습니다.     │
│  태풍 대비 완료!                 │
│                                 │
│  약 18,000원을 절약하셨습니다.   │
│                                 │
│           [확인]                 │
└─────────────────────────────────┘
```

---

## Deep Link 스키마

### 쇼핑 리스트 생성
```
smartledger://shopping/generate?condition=typhoon&days=3
smartledger://shopping/generate?condition=coldWave&days=1
smartledger://shopping/generate?condition=heavyRain&days=7
```

### 파라미터
- `condition`: 날씨 조건 (typhoon, coldWave, heavyRain, heatWave, snowy)
- `days`: 며칠 후인지 (0~7)
- `family`: 가족 수 (기본값 2)

---

## 가격 데이터베이스

### 신선식품 (가격 변동 큼)
| 품목 | 단가 | 단위 | 태풍 민감도 | 한파 민감도 |
|------|------|------|-----------|-----------|
| 배추 | 3,000원 | 포기 | +20% | +12% |
| 사과 | 1,500원 | 개 | +20% | +8% |
| 계란 | 300원 | 개 | +4% | +12% |
| 오이 | 500원 | 개 | +18% | +14% |

### 안전용품 (고정 가격)
| 품목 | 단가 |
|------|------|
| 생수 (2L) | 1,000원 |
| 손전등 | 15,000원 |
| 건전지 | 500원 |
| 핫팩 | 300원 |

### 비축식품
| 품목 | 단가 |
|------|------|
| 라면 | 800원 |
| 통조림 | 2,000원 |

---

## 설정 확장

### 가족 수 설정
```dart
// 향후 앱 설정에 추가
SharedPreferences.setInt('family_size', 4);
```

### 알림 시점 설정
```dart
// 며칠 전부터 알림받을지
SharedPreferences.setInt('alert_days_before', 3);
```

### 예산 설정
```dart
// 최대 구매 예산
SharedPreferences.setInt('shopping_budget', 150000);
```

---

## 성능 최적화

### 가격 데이터 캐싱
- 품목별 가격: 정적 데이터 (앱 내장)
- 향후 실시간 API 연동 가능

### 쇼핑 리스트 저장
```dart
// SharedPreferences에 저장
final json = jsonEncode(shoppingList);
prefs.setString('last_shopping_list', json);
```

---

## 향후 확장

### 1. 마트 위치 연동
```dart
// 가까운 마트 찾기
findNearbyMarts(userLocation);
```

### 2. 가격 비교
```dart
// 마트별 가격 비교
comparePrices(items, marts);
```

### 3. 자동 재고 체크
```dart
// 냉장고 재고와 비교
checkInventory(shoppingList, currentInventory);
```

### 4. 푸시 알림
```dart
// 3일 전 자동 알림
scheduleNotification(
  title: '태풍 3일 전! 장보기 하세요',
  body: '배추, 사과 등 8개 품목 확인',
);
```

---

## 문의

- 품목 추가/수정: `lib/utils/shopping_list_generator.dart`
- 가격 조정: `itemPriceDatabase` 맵
- UI 커스터마이징: `lib/screens/shopping_list_screen.dart`

**실용성 최우선**: 구체적 수량, 가격, 절약액을 명시하여 실질적 도움 제공
