# 자산 관리(Asset Management) 기능 보고서
**작성일:** 2026-01-04  
**상태:** ✅ 구현 완료(기본 → 고급 기능 포함)  
**담당 범위:** 자산 입력, 조회, 분석, 보안

---

## 📋 개요

자산 관리(Asset Management) 기능은 **계정별 재무 자산을 추적하고 분석**하는 Smart Ledger의 핵심 금융 기능입니다. 단순 현금 관리부터 복잡한 투자 포트폴리오까지 전생애주기 자산 추적을 지원합니다.

### 자산 관리의 중요성
```
가계부의 세 축:
1. 거래(Transactions) - "언제 돈을 쓰는가?"
2. 자산(Assets) - "현재 얼마를 가지고 있는가?"  ← ⭐ 이 보고서 범위
3. 예산(Budget) - "앞으로 얼마를 쓸 것인가?"

재무 건강도 = 거래 패턴 + 자산 상황 + 예산 계획
```

---

## 🏗️ 아키텍처

### 자산 관리 컴포넌트

| 컴포넌트 | 경로 | 역할 | 라우트 | 상태 |
|---------|------|------|---------|------|
| **Asset 모델** | `lib/models/asset.dart` | 자산 데이터 구조 | - | ✅ 완료 |
| **자산 대시보드** | `lib/screens/asset_dashboard_screen.dart` | 총자산, 손익, 타임라인 | `/asset/dashboard` | ✅ 완료 |
| **간편 입력** | `lib/screens/asset_simple_input_screen.dart` | 5초 자산 입력 | `/asset/input/simple` | ✅ 완료 |
| **상세 입력** | `lib/screens/asset_input_screen.dart` | 상세 정보 입력 | `/asset/input/detail` | ✅ 완료 |
| **자산 탭** | `lib/screens/asset_tab_screen.dart` | 자산 관리 메인(생체인증 포함) | `/asset/tab` | ✅ 완료 |
| **자산 배분** | `lib/screens/asset_allocation_screen.dart` | 포트폴리오 분석 | `/asset/allocation` | ✅ 완료 |
| **자산 평가** | `lib/screens/asset_management_screen.dart` | 자산 평가 화면 | `/asset/management` | ✅ 완료 |
| **자산 상세** | `lib/screens/asset_detail_screen.dart` | 자산별 상세 정보 | - | ✅ 완료 |
| **1억 프로젝트** | `lib/screens/asset_project_100m_screen.dart` | 자산 목표 추적 | `/asset/project-100m` | ✅ 완료 |
| **AssetService** | `lib/services/asset_service.dart` | CRUD 및 데이터 관리 | - | ✅ 완료 |
| **자산 이동 추적** | `lib/services/asset_move_service.dart` | 자산 이동 기록 | - | ✅ 완료 |
| **인증 게이트** | `lib/widgets/asset_route_auth_gate.dart` | 자산 보호 인증 | - | ✅ 완료 |

---

## 📊 자산 데이터 모델

### Asset 클래스 구조

```dart
class Asset {
  final String id;                      // 고유 ID
  final String name;                    // 자산명 (예: "삼성전자 주식")
  final double amount;                  // 현재 금액
  final AssetInputType inputType;       // simple (간편) vs detail (상세)
  final String memo;                    // 메모
  final DateTime date;                  // 자산 등록일
  final AssetCategory category;         // 카테고리
  
  // 투자/수익 관련
  final double? expectedAnnualRatePct;  // 기대 수익률(연 %)
  final double? targetRatio;            // 목표 비율(%)
  final double? targetAmount;           // 목표액(투자 자산)
  final bool isInvestment;              // 투자 여부
  final DateTime? conversionDate;       // 전환된 날짜
  final double? costBasis;              // 원가(손익 계산용)
}
```

### AssetCategory (7가지)

```dart
enum AssetCategory {
  stock('주식', '📈', 색상),           // 주식
  bond('채권', '📊', 색상),            // 채권
  realEstate('부동산', '🏠', 색상),    // 부동산
  deposit('예금/적금', '🏦', 색상),   // 은행 상품
  crypto('암호화폐', '₿', 색상),      // 비트코인 등
  cash('현금', '💵', 색상),            // 현금
  other('기타', '📌', 색상);           // 기타 자산
}
```

### AssetInputType (2가지)

```dart
enum AssetInputType {
  simple,     // 간편 입력: 자산명, 금액, 메모만
  detail,     // 상세 입력: 수익률, 목표액, 원가 등 상세
}
```

---

## 🔄 자산 관리 3가지 경로

### 경로 1️⃣: 간편 입력 (AssetSimpleInputScreen)

**사용 시기:** "빠르게 현금, 예금 기록하고 싶을 때" (5초)

```
대시보드 또는 탭 화면
   ↓
[자산 추가] 버튼 → AssetSimpleInputScreen
   ├─ 자산 종류 선택 (Dropdown)
   │  ├─ 현금
   │  ├─ 예금/적금
   │  ├─ 소액 투자
   │  └─ 기타 실물 자산
   │
   ├─ 자산명 입력 (예: "시중은행 입출금")
   ├─ 금액 입력 (예: "1,500,000")
   ├─ 위치 입력 (선택, 예: "강남 지점")
   ├─ 메모 입력 (최근 메모 자동 완성)
   │
   └─ [저장] → AssetService.addAsset()
      ├─ SharedPreferences에 저장
      ├─ 최근 메모 저장
      └─ 자산 목록 새로고침
```

**코드 위치:** [AssetSimpleInputScreen](lib/screens/asset_simple_input_screen.dart#L1-L50)

**특징:**
- ✅ 최소 정보로 빠른 입력
- ✅ 최근 메모 자동 완성
- ✅ 입력 후 리스트 자동 업데이트
- ✅ 폼 검증 (필수값 확인)

**UI:**
```
┌─────────────────────────┐
│ 자산 추가 (간편)          │
├─────────────────────────┤
│ [v 현금]                │
│ [자산명] 예: 시중은행...│
│ [금액] 1,500,000       │
│ [위치] 강남 지점        │
│ [메모▼] (최근값)        │
│                         │
│ [저장]                  │
└─────────────────────────┘
```

---

### 경로 2️⃣: 상세 입력 (AssetInputScreen)

**사용 시기:** "투자 자산의 수익률, 원가, 목표액까지 기록하고 싶을 때"

```
AssetInputScreen
   ├─ 기본 정보
   │  ├─ 자산명 (필수)
   │  ├─ 금액 (필수)
   │  └─ 카테고리 선택 (stock, bond, realEstate, ...)
   │
   ├─ 수익 및 목표
   │  ├─ 기대수익률 (연 %, 선택)
   │  ├─ 목표 비율 (%, 선택)
   │  └─ 원가 (손익 계산용, 선택)
   │
   ├─ 투자 목표 설정
   │  ├─ [투자 목표 설정] 토글
   │  └─ 활성화 시:
   │     ├─ 목표액 입력
   │     └─ 도달 시 자동 전환 여부
   │
   ├─ 메모 및 날짜
   │  ├─ 메모 (선택)
   │  └─ 날짜 선택
   │
   └─ [저장] → AssetService.addAsset()
      ├─ 모든 필드 저장
      ├─ 수익률 기반 자동 계산
      └─ 타임라인 생성
```

**코드 위치:** [AssetInputScreen](lib/screens/asset_input_screen.dart#L1-L100)

**주요 기능:**
- ✅ 완전한 자산 정보 입력
- ✅ 수익률 기반 손익 자동 계산
- ✅ 투자 목표 추적
- ✅ 원가 기반 손익률 계산
- ✅ 자동 전환 기능

**수익률 계산:**
```dart
// 예: 주식 매매
costBasis: 100,000       // 매수가
amount: 120,000          // 현재가
expectedRate: 20%        // 손익률

손익 = 120,000 - 100,000 = 20,000원
손익률 = 20,000 / 100,000 * 100 = 20%
```

---

### 경로 3️⃣: 관리 및 조회 (AssetTabScreen / 대시보드)

```
AssetTabScreen (메인)
   ├─ 생체 인증 (지문/PIN/비밀번호)
   │  └─ 자산 정보 보호
   │
   ├─ 자산 대시보드
   │  ├─ 총 자산액 표시
   │  ├─ 총 손익 표시
   │  ├─ 손익률(%) 표시
   │  └─ 자산별 카드
   │
   ├─ 자산 배분 분석
   │  ├─ 카테고리별 구성비
   │  ├─ 목표 대비 현황
   │  └─ 재배분 제안
   │
   ├─ 1억 프로젝트
   │  ├─ 자산 목표 추적
   │  └─ 진도율 표시
   │
   └─ 자산 관리 액션
      ├─ [자산 추가]
      ├─ [자산 편집]
      ├─ [자산 삭제]
      ├─ [내보내기] (CSV/Excel)
      └─ [비상금 관리]
```

---

## 🔐 자산 보안 (생체 인증)

### AssetTabScreen의 생체 인증

```dart
// 자산 탭 진입 시 인증 요구
Future<bool> _authenticate() async {
  // 1. 생체인증 장치 확인
  final canCheckBiometrics = await _localAuth.canCheckBiometrics;
  final isDeviceSupported = await _localAuth.deviceSupportsBiometrics;
  
  if (canCheckBiometrics || isDeviceSupported) {
    // 2. 생체인증 실행
    return await _localAuth.authenticate(
      localizedReason: '자산 정보를 보호하기 위해 인증이 필요합니다',
      options: const AuthenticationOptions(
        stickyAuth: true,
        biometricOnly: false,
      ),
    );
  }
  
  // 3. 생체인증 미지원 시 PIN/비밀번호
  return _showAuthChoiceDialog();
}
```

**인증 선택 옵션:**
```
자산 보호 인증
├─ [지문 인증] (생체인증 사용 가능)
├─ [PIN] (4자리 PIN)
├─ [비밀번호] (계정 비밀번호)
└─ [취소]
```

**코드 위치:** [AssetTabScreen._AssetAuthChoiceDialog](lib/screens/asset_tab_screen.dart#L31-L70)

---

## 📊 자산 대시보드 (AssetDashboardScreen)

### 주요 표시 정보

```
자산 대시보드
├─ [📊 대시보드 요약]
│  ├─ 총 자산: ₩X,XXX,XXX
│  ├─ 총 손익: ₩Y,YYY (색상: 빨강/초록)
│  ├─ 손익률: Z%
│  └─ 전일 대비: ±A%
│
├─ [📈 자산별 카드 뷰]
│  └─ 각 자산마다:
│     ├─ 자산명 + 카테고리 이모지
│     ├─ 현재가 (큰 폰트)
│     ├─ 원가 (작은 폰트)
│     ├─ 손익 + 색상 강조
│     └─ 손익률(%)
│
└─ [⏱️ 최근 타임라인]
   └─ 자산 이동 기록 (최신 순)
      ├─ 타임스탬프
      ├─ 변동 금액
      └─ 설명
```

**코드 위치:** [AssetDashboardScreen](lib/screens/asset_dashboard_screen.dart#L1-L100)

**특징:**
- ✅ 실시간 총자산 계산
- ✅ 손익 자동 계산 (costBasis 기반)
- ✅ 자산별 상세 카드
- ✅ 최근 변동 타임라인

---

## 📊 자산 배분 분석 (AssetAllocationScreen)

### 포트폴리오 구성 분석

```
자산 배분 분석
├─ [총 자산액]
│  └─ ₩X,XXX,XXX (N개 자산)
│
├─ [카테고리별 자산 배분]
│  ├─ 주식: 40% (₩400,000)
│  ├─ 부동산: 30% (₩300,000)
│  ├─ 현금: 20% (₩200,000)
│  ├─ 예금: 7% (₩70,000)
│  └─ 기타: 3% (₩30,000)
│
├─ [원형 차트]
│  └─ 각 카테고리별 비율 시각화
│
├─ [목표 대비 현황]
│  ├─ 목표 배분: (설정된 targetRatio 기반)
│  └─ 실제 배분: (현재 자산 기반)
│     └─ 차이 표시 및 재배분 제안
│
└─ [자산 목록]
   └─ 각 자산 탭
      ├─ 자산명
      ├─ 금액
      ├─ 구성비(%)
      └─ 액션 (편집/삭제)
```

**코드 위치:** [AssetAllocationScreen](lib/screens/asset_allocation_screen.dart#L1-L100)

---

## 🎯 1억 프로젝트 (Asset100MScreen)

**목적:** 자산 목표(예: 1억원)를 설정하고 진도를 추적

```
1억 프로젝트 화면
├─ [목표 설정]
│  ├─ 목표액: 100,000,000원
│  └─ 목표 달성일: YYYY-MM-DD
│
├─ [진도 표시]
│  ├─ 현재 자산: 45,000,000원
│  ├─ 달성률: 45%
│  ├─ 남은 금액: 55,000,000원
│  └─ 프로그레스 바 (시각적)
│
├─ [목표 달성 전략]
│  ├─ 필요 기간: XX개월
│  ├─ 월평균 필요액: X,XXX,XXX원
│  └─ 현재 속도 평가 (빠름/적절/느림)
│
└─ [마일스톤]
   ├─ 25% 달성: 25,000,000 (예상: 2025-12월)
   ├─ 50% 달성: 50,000,000 (예상: 2026-12월)
   ├─ 75% 달성: 75,000,000 (예상: 2027-12월)
   └─ 100% 달성: 100,000,000 (예상: 2028-12월)
```

**코드 위치:** [AssetProject100mScreen](lib/screens/asset_project_100m_screen.dart)

---

## 💰 수입 분배 연동 (Asset ↔ Transaction)

### 수입 입력 시 자산 배분

```
거래 입력 화면에서 수입 저장
   ↓
[수입 분배] 다이얼로그 표시
   ├─ 이 수입(₩X,XXX)을 어떻게 처리할까요?
   └─ 선택지:
      ├─ [자산 배분하기] → AssetAllocationDialog
      │  └─ 수입을 자산으로 분배 (예: 주식 40%, 현금 60%)
      │     ↓
      │     AssetService.addAsset() 자동 호출
      │
      └─ [현금 추가만] → 현금 자산에 그냥 추가
```

**장점:**
- ✅ 수입이 어디로 가는지 추적
- ✅ 자산 비율 자동 유지
- ✅ 재정 목표 달성 추적

---

## ✅ 자산 관리 특징 및 고급 기능

### 기본 기능
| 기능 | 설명 | 상태 |
|------|------|------|
| 자산 추가/편집/삭제 | CRUD 기본 | ✅ |
| 간편 입력 | 5초 입력 | ✅ |
| 상세 입력 | 수익률, 원가 등 | ✅ |
| 생체 인증 | 지문/PIN/비번 | ✅ |
| 대시보드 | 총자산, 손익 표시 | ✅ |

### 고급 기능
| 기능 | 설명 | 상태 |
|------|------|------|
| 손익 계산 | 원가 기반 자동 계산 | ✅ |
| 자산 배분 | 포트폴리오 분석 | ✅ |
| 1억 프로젝트 | 목표 추적 | ✅ |
| 자산 이동 추적 | 타임라인 기록 | ✅ |
| CSV/Excel 내보내기 | 데이터 내보내기 | ✅ |
| 수입 분배 연동 | 거래 ↔ 자산 | ✅ |

---

## 🧪 검증 항목 (수행 필요)

### 단계 1: 기본 자산 입력

#### A. 간편 입력 테스트
```
1. AssetSimpleInputScreen 진입
2. 자산 종류: "현금"
3. 자산명: "시중은행"
4. 금액: "1,500,000"
5. 메모: "생활비"
6. [저장]
7. 확인:
   - 자산 목록에 추가됨
   - 금액 정확함
   - 메모 저장됨
```

#### B. 상세 입력 테스트
```
1. AssetInputScreen 진입
2. 자산명: "삼성전자 주식"
3. 카테고리: "주식"
4. 금액: "2,000,000"
5. 원가: "1,500,000"
6. 기대수익률: "15%"
7. [저장]
8. 확인:
   - 손익: 500,000원 (초록색)
   - 손익률: 33.3%
```

### 단계 2: 생체 인증

#### A. 생체 인증 테스트
```
1. AssetTabScreen 진입
2. 생체인증 창 표시 확인
3. [지문] → 지문 인식 후 진입 확인
4. 생체인증 해제 후 재진입
5. [PIN] → PIN 4자리 입력 후 진입 확인
```

#### B. 인증 선택지
```
1. 생체인증 미지원 기기 또는 인증 실패
2. [인증 선택] 다이얼로그 나타남
3. 각 옵션 테스트:
   - [지문]: 사용 가능 여부
   - [PIN]: PIN 입력 후 진입
   - [비번]: 계정 비번 입력 후 진입
   - [취소]: 뒤로 가기
```

### 단계 3: 대시보드 검증

#### A. 요약 정보
```
1. 자산 3개 추가 (현금, 주식, 부동산)
2. 대시보드 진입
3. 확인:
   - 총 자산: 정확한 합계
   - 총 손익: 원가 기반 계산 정확
   - 손익률: 정확한 %
   - 색상: 손익 양음 기반 (초록/빨강)
```

#### B. 자산별 카드
```
1. 각 자산 카드 표시 확인
2. 각 카드에 다음 정보 있는지 확인:
   - 자산명
   - 현재가 (크기 강조)
   - 원가 또는 금액
   - 손익액 + 색상
   - 손익률(%)
3. 카드 탭 → 자산 상세 화면 진입 확인
```

#### C. 타임라인
```
1. 최근 자산 이동 기록 표시 확인
2. 최신순 정렬 확인
3. 각 항목에 타임스탬프, 금액, 설명 있는지 확인
```

### 단계 4: 자산 배분 분석

#### A. 배분 비율
```
1. 자산 3개 추가:
   - 주식: 1,000,000
   - 부동산: 2,000,000
   - 현금: 1,000,000
   총 4,000,000
2. 배분 분석 진입
3. 확인:
   - 주식: 25%
   - 부동산: 50%
   - 현금: 25%
```

#### B. 원형 차트
```
1. 차트 표시 확인
2. 각 카테고리 색상 표시 확인
3. 범례(legend) 표시 확인
```

#### C. 목표 대비 현황
```
1. targetRatio 설정한 자산 확인
2. 실제 배분 vs 목표 비율 비교
3. 차이 표시 확인
```

### 단계 5: 1억 프로젝트

#### A. 목표 설정
```
1. AssetProject100mScreen 진입
2. [목표 설정]
3. 목표액: 100,000,000
4. 목표 달성일: 2028-12-31
5. [저장]
6. 목표 표시 확인
```

#### B. 진도 추적
```
1. 현재 자산: 45,000,000
2. 확인:
   - 달성률: 45% 정확
   - 남은 금액: 55,000,000
   - 프로그레스 바: 45까지 채워짐
   - 필요 기간: XX개월 계산 정확
```

#### C. 마일스톤
```
1. 25%, 50%, 75%, 100% 마일스톤 표시 확인
2. 예상 달성 시점 표시 확인
3. 현재 속도 평가 (빠름/적절/느림) 표시 확인
```

### 단계 6: 수입 분배 연동

#### A. 거래 입력 시 분배
```
1. 거래 입력 화면에서 수입 추가
   - 거래명: "월급"
   - 금액: "5,000,000"
   - 거래 유형: 수입
2. 저장 시 [수입 분배] 다이얼로그 표시 확인
```

#### B. 자산으로 배분
```
1. [자산 배분하기] 선택
2. 배분 비율 입력:
   - 주식: 40%
   - 현금: 60%
3. [확인]
4. 확인:
   - 주식 자산 증가: +2,000,000
   - 현금 자산 증가: +3,000,000
   - 자산 목록 새로고침
```

#### C. 현금 추가
```
1. [현금 추가만] 선택
2. 확인:
   - 현금 자산만 증가
   - 수입 거래 기록됨
```

### 단계 7: 데이터 관리

#### A. CSV 내보내기
```
1. AssetTabScreen → [내보내기] 메뉴
2. [CSV로 내보내기]
3. 파일 선택 후 저장
4. 파일 확인:
   - 자산명, 금액, 카테고리 등 포함
   - 엑셀에서 열림
```

#### B. Excel 내보내기
```
1. [Excel로 내보내기]
2. 파일 저장
3. 엑셀에서 열기
4. 포맷 확인 (스타일, 컬러 등)
```

### 단계 8: 에지 케이스

- [ ] 자산 없을 때 대시보드 → "등록된 자산이 없습니다" 메시지
- [ ] 금액 0원 입력 → 검증 에러 표시
- [ ] 수익률 -50% 입력 → 손실 정확히 계산됨
- [ ] 자산 삭제 → 대시보드 즉시 반영
- [ ] 생체인증 장치 없음 → PIN/비번 선택 옵션
- [ ] 매우 큰 금액(9,999,999,999) → 오버플로우 없음
- [ ] 매우 작은 금액(0.01) → 소수점 처리 정확

---

## 📚 관련 파일 및 문서

- [Asset 모델](lib/models/asset.dart)
- [AssetService](lib/services/asset_service.dart)
- [AssetDashboardScreen](lib/screens/asset_dashboard_screen.dart)
- [AssetSimpleInputScreen](lib/screens/asset_simple_input_screen.dart)
- [AssetInputScreen](lib/screens/asset_input_screen.dart)
- [AssetTabScreen](lib/screens/asset_tab_screen.dart)
- [AssetAllocationScreen](lib/screens/asset_allocation_screen.dart)
- [AssetRouteAuthGate](lib/widgets/asset_route_auth_gate.dart)
- [자산 와이어프레임](docs/wireframes_asset_tax.md)

---

## 🚀 다음 단계

1. ✅ **자산 코드 검증** - `flutter analyze` 통과 확인
2. **실제 시나리오 테스트** - 위의 검증 항목 수행
3. **생체 인증 강화 (선택)**
   - 추가 생체인증 방식 (홍채 인식 등)
   - 재인증 주기 설정
4. **기능 확장 (선택)**
   - 세금 계산 기능
   - 자산 이동 추적 상세화
   - AI 기반 투자 조언
   - 자산 가치 실시간 업데이트 (API 연동)

---

## 📈 향후 확장 가능성

- 🔮 **실시간 시세 연동:** 주식, 암호화폐 실시간 가격 업데이트
- 🔮 **세금 시뮬레이션:** 양도소득세, 배당세 자동 계산
- 🔮 **포트폴리오 최적화:** AI 기반 재배분 제안
- 🔮 **자산 이력:** 매매 기록, 손익통산 자동 계산
- 🔮 **리밸런싱 알림:** 목표 배분과 현황 격차 자동 알림
- 🔮 **멀티 통화:** 달러, 유로 등 외화 자산 지원
- 🔮 **부동산 평가:** 전월세, 시세 연동
- 🔮 **보험료 추적:** 생명보험, 손해보험 포함
- 🔮 **유산 계획:** 상속 시뮬레이션

---

**작성:** GitHub Copilot  
**마지막 검토:** 2026-01-04
